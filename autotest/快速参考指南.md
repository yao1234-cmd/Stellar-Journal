# æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ - å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡ŒæŒ‡å®šæ–‡ä»¶
pytest tests/test_doctor_api.py

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç”¨ä¾‹
pytest tests/test_doctor_api.py::TestDoctorAPI::test_get_doctors_success

# è¿è¡Œæ ‡è®°çš„æµ‹è¯•
pytest -m smoke          # å†’çƒŸæµ‹è¯•
pytest -m positive       # æ­£å‘æµ‹è¯•
pytest -m negative       # è´Ÿå‘æµ‹è¯•

# è¯¦ç»†è¾“å‡º
pytest -v

# æŸ¥çœ‹æŠ¥å‘Š
allure serve ./reports/allure-results
```

---

## ğŸ“¦ æ ¸å¿ƒå·¥å…·ç±»ä½¿ç”¨

### HTTPClient - å‘é€HTTPè¯·æ±‚

```python
from utils.http_client import HTTPClient

# åˆ›å»ºå®¢æˆ·ç«¯ï¼ˆé€šå¸¸åœ¨fixtureä¸­å·²åˆ›å»ºï¼‰
http_client = HTTPClient()

# GETè¯·æ±‚
response = http_client.get("/api/doctors")
response = http_client.get("/api/doctors", params={"department": "å†…ç§‘"})

# POSTè¯·æ±‚
data = {"name": "æµ‹è¯•è¯ç‰©", "price": 10.50}
response = http_client.post("/api/medicines", json_data=data)

# PUTè¯·æ±‚
data = {"status": "åœ¨èŒ"}
response = http_client.put("/api/doctors/1/status", json_data=data)

# DELETEè¯·æ±‚
response = http_client.delete("/api/medicines/1")

# è·å–å“åº”ä¿¡æ¯
status_code = response.status_code      # çŠ¶æ€ç 
json_data = response.json()             # JSONå“åº”
text = response.text                     # æ–‡æœ¬å“åº”
elapsed = response.elapsed.total_seconds()  # å“åº”æ—¶é—´ï¼ˆç§’ï¼‰
```

### AssertionHelper - æ–­è¨€éªŒè¯

```python
from utils.assertion_helper import assert_helper

# æ–­è¨€çŠ¶æ€ç 
assert_helper.assert_status_code(response, 200)

# æ–­è¨€å“åº”æ—¶é—´
assert_helper.assert_response_time(response, 5.0)

# æ–­è¨€JSONç»“æ„
assert_helper.assert_json_structure(response, ['code', 'data', 'total'])

# æ–­è¨€JSONå€¼
assert_helper.assert_json_value(response, 'code', 0)
assert_helper.assert_json_value(response, 'data.0.name', 'é˜¿è«è¥¿æ—')  # åµŒå¥—è·¯å¾„

# æ–­è¨€JSONåŒ…å«
assert_helper.assert_json_contains(response, 'message', 'æˆåŠŸ')

# æ–­è¨€åˆ—è¡¨é•¿åº¦
assert_helper.assert_list_length(response, 'data', 10)

# æ–­è¨€åˆ—è¡¨ä¸ä¸ºç©º
assert_helper.assert_list_not_empty(response, 'data')
```

### ConfigManager - é…ç½®ç®¡ç†

```python
from utils.config_manager import config

# è·å–åŸºç¡€URL
base_url = config.get_base_url()

# è·å–è¶…æ—¶æ—¶é—´
timeout = config.get_timeout()

# è·å–é‡è¯•æ¬¡æ•°
retry_count = config.get_retry_count()

# è·å–æµ‹è¯•æ•°æ®
medicine_data = config.get_test_data('valid_medicine')
patient_data = config.get_test_data('valid_patient')

# é€šç”¨è·å–æ–¹æ³•
value = config.get('test_env.base_url')
```

### DataGenerator - æ•°æ®ç”Ÿæˆ

```python
from utils.data_generator import data_generator

# ç”Ÿæˆè¯ç‰©æ•°æ®
medicine = data_generator.generate_medicine_data()
medicine = data_generator.generate_medicine_data(name="è‡ªå®šä¹‰åç§°", price=20.0)

# ç”Ÿæˆæ‚£è€…æ•°æ®
patient = data_generator.generate_patient_data()

# ç”ŸæˆåŒ»ç”Ÿæ•°æ®
doctor = data_generator.generate_doctor_data()

# ç”Ÿæˆå°±è¯Šæ•°æ®
consultation = data_generator.generate_consultation_data()

# ç”Ÿæˆé¢„çº¦æ•°æ®
appointment = data_generator.generate_appointment_data()

# ç”Ÿæˆæ— æ•ˆæ•°æ®ï¼ˆç”¨äºè´Ÿå‘æµ‹è¯•ï¼‰
invalid_medicine = data_generator.generate_invalid_data('medicine')
```

---

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¼–å†™æ¨¡æ¿

### åŸºç¡€æ¨¡æ¿

```python
# -*- coding: utf-8 -*-
"""
æ¨¡å—è¯´æ˜
"""

import pytest
import allure
from utils.http_client import HTTPClient
from utils.assertion_helper import assert_helper


@allure.epic("äº‘åŒ»ç–—ç³»ç»Ÿ")
@allure.feature("åŠŸèƒ½æ¨¡å—åç§°")
class TestYourAPI:
    """æµ‹è¯•ç±»è¯´æ˜"""
    
    @allure.story("ç”¨æˆ·æ•…äº‹")
    @allure.title("æµ‹è¯•ç”¨ä¾‹æ ‡é¢˜")
    @allure.severity(allure.severity_level.CRITICAL)
    @pytest.mark.smoke
    @pytest.mark.positive
    def test_your_case(self, http_client: HTTPClient):
        """æµ‹è¯•ç”¨ä¾‹è¯´æ˜"""
        with allure.step("æ­¥éª¤1: æè¿°"):
            response = http_client.get("/api/endpoint")
        
        with allure.step("æ­¥éª¤2: éªŒè¯"):
            assert_helper.assert_status_code(response, 200)
            assert_helper.assert_json_structure(response, ['code', 'data'])
```

### æ­£å‘æµ‹è¯•ç”¨ä¾‹

```python
@allure.story("è·å–åˆ—è¡¨")
@allure.title("è·å–åˆ—è¡¨ - æ­£å¸¸åœºæ™¯")
@pytest.mark.positive
def test_get_list_success(self, http_client: HTTPClient):
    """æµ‹è¯•è·å–åˆ—è¡¨çš„æ­£å¸¸åŠŸèƒ½"""
    with allure.step("å‘é€è·å–åˆ—è¡¨è¯·æ±‚"):
        response = http_client.get("/api/items")
    
    with allure.step("éªŒè¯å“åº”"):
        assert_helper.assert_status_code(response, 200)
        assert_helper.assert_response_time(response, 5.0)
        assert_helper.assert_json_structure(response, ['code', 'data'])
        assert_helper.assert_json_value(response, 'code', 0)
```

### è´Ÿå‘æµ‹è¯•ç”¨ä¾‹

```python
@allure.story("è·å–è¯¦æƒ…")
@allure.title("è·å–ä¸å­˜åœ¨çš„èµ„æº")
@pytest.mark.negative
def test_get_not_found(self, http_client: HTTPClient):
    """æµ‹è¯•è·å–ä¸å­˜åœ¨çš„èµ„æº"""
    with allure.step("å‘é€è·å–ä¸å­˜åœ¨èµ„æºçš„è¯·æ±‚"):
        response = http_client.get("/api/items/99999")
    
    with allure.step("éªŒè¯è¿”å›404"):
        assert_helper.assert_status_code(response, 404)
        assert_helper.assert_json_structure(response, ['detail'])
```

### å‚æ•°åŒ–æµ‹è¯•ç”¨ä¾‹

```python
@allure.story("ç­›é€‰åŠŸèƒ½")
@allure.title("æŒ‰æ¡ä»¶ç­›é€‰")
@pytest.mark.parametrize("category", ["ç±»å‹1", "ç±»å‹2", "ç±»å‹3"])
def test_filter_by_category(self, http_client: HTTPClient, category):
    """æµ‹è¯•æŒ‰æ¡ä»¶ç­›é€‰"""
    with allure.step(f"å‘é€æŒ‰'{category}'ç­›é€‰çš„è¯·æ±‚"):
        response = http_client.get("/api/items", params={"category": category})
    
    with allure.step("éªŒè¯å“åº”"):
        assert_helper.assert_status_code(response, 200)
        assert_helper.assert_json_value(response, 'code', 0)
```

### POSTåˆ›å»ºèµ„æºæµ‹è¯•ç”¨ä¾‹

```python
@allure.story("åˆ›å»ºèµ„æº")
@allure.title("åˆ›å»ºèµ„æº - æ­£å¸¸åœºæ™¯")
@pytest.mark.positive
def test_create_item_success(self, http_client: HTTPClient, test_data):
    """æµ‹è¯•åˆ›å»ºèµ„æºçš„æ­£å¸¸åŠŸèƒ½"""
    # å‡†å¤‡æµ‹è¯•æ•°æ®
    item_data = test_data.generate_item_data()
    
    with allure.step("å‘é€åˆ›å»ºèµ„æºè¯·æ±‚"):
        response = http_client.post("/api/items", json_data=item_data)
    
    with allure.step("éªŒè¯å“åº”"):
        assert_helper.assert_status_code(response, 200)
        assert_helper.assert_json_structure(response, ['code', 'data', 'message'])
        assert_helper.assert_json_value(response, 'code', 0)
        
        # éªŒè¯è¿”å›çš„æ•°æ®
        json_data = response.json()
        created_item = json_data['data']
        assert created_item['name'] == item_data['name']
```

---

## ğŸ·ï¸ pytestæ ‡è®°è¯´æ˜

### æ ‡è®°å®šä¹‰ï¼ˆpytest.iniï¼‰

```ini
markers =
    smoke: å†’çƒŸæµ‹è¯•
    regression: å›å½’æµ‹è¯•
    api: APIæ¥å£æµ‹è¯•
    positive: æ­£å‘æµ‹è¯•ç”¨ä¾‹
    negative: è´Ÿå‘æµ‹è¯•ç”¨ä¾‹
    boundary: è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹
    performance: æ€§èƒ½æµ‹è¯•ç”¨ä¾‹
```

### ä½¿ç”¨æ ‡è®°

```python
@pytest.mark.smoke
@pytest.mark.positive
def test_case():
    pass
```

### è¿è¡Œæ ‡è®°çš„æµ‹è¯•

```bash
pytest -m smoke          # åªè¿è¡Œå†’çƒŸæµ‹è¯•
pytest -m "smoke and positive"  # è¿è¡ŒåŒæ—¶æ ‡è®°ä¸ºsmokeå’Œpositiveçš„æµ‹è¯•
pytest -m "not negative"      # è¿è¡Œä¸æ˜¯negativeçš„æµ‹è¯•
```

---

## ğŸ“Š Allureè£…é¥°å™¨è¯´æ˜

### è£…é¥°å™¨å±‚çº§

```
@allure.epic("äº‘åŒ»ç–—ç³»ç»Ÿ")           # æœ€é¡¶å±‚ï¼šç³»ç»Ÿ/äº§å“
  â””â”€â”€ @allure.feature("åŒ»ç”Ÿç®¡ç†")    # åŠŸèƒ½æ¨¡å—
      â””â”€â”€ @allure.story("è·å–åŒ»ç”Ÿåˆ—è¡¨")  # ç”¨æˆ·æ•…äº‹
          â””â”€â”€ @allure.title("è·å–åŒ»ç”Ÿåˆ—è¡¨ - æ­£å¸¸åœºæ™¯")  # æµ‹è¯•ç”¨ä¾‹æ ‡é¢˜
```

### ä¸¥é‡ç¨‹åº¦

```python
@allure.severity(allure.severity_level.BLOCKER)   # é˜»å¡
@allure.severity(allure.severity_level.CRITICAL)  # ä¸¥é‡
@allure.severity(allure.severity_level.NORMAL)    # ä¸€èˆ¬
@allure.severity(allure.severity_level.MINOR)      # è½»å¾®
@allure.severity(allure.severity_level.TRIVIAL)   # æ— å…³ç´§è¦
```

### æµ‹è¯•æ­¥éª¤

```python
with allure.step("æ­¥éª¤æè¿°"):
    # æ‰§è¡Œæ“ä½œ
    response = http_client.get("/api/endpoint")
    
    # é™„åŠ ä¿¡æ¯åˆ°æŠ¥å‘Š
    allure.attach(
        "é™„åŠ çš„æ–‡æœ¬ä¿¡æ¯",
        name="ä¿¡æ¯åç§°",
        attachment_type=allure.attachment_type.TEXT
    )
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### pytestå‘½ä»¤

```bash
# åŸºæœ¬è¿è¡Œ
pytest                                    # è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/                            # è¿è¡ŒæŒ‡å®šç›®å½•
pytest tests/test_doctor_api.py          # è¿è¡ŒæŒ‡å®šæ–‡ä»¶

# è¾“å‡ºæ§åˆ¶
pytest -v                                # è¯¦ç»†è¾“å‡º
pytest -s                                # æ˜¾ç¤ºprintè¾“å‡º
pytest -vv                               # æ›´è¯¦ç»†è¾“å‡º
pytest --tb=short                        # ç®€çŸ­é”™è¯¯ä¿¡æ¯

# æ ‡è®°è¿‡æ»¤
pytest -m smoke                          # è¿è¡Œæ ‡è®°ä¸ºsmokeçš„æµ‹è¯•
pytest -m "smoke and positive"          # è¿è¡ŒåŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ ‡è®°çš„æµ‹è¯•

# å¹¶è¡Œè¿è¡Œï¼ˆéœ€è¦pytest-xdistï¼‰
pytest -n auto                           # è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°å¹¶è¡Œè¿è¡Œ

# å¤±è´¥é‡è¯•ï¼ˆéœ€è¦pytest-rerunfailuresï¼‰
pytest --reruns 3                        # å¤±è´¥åé‡è¯•3æ¬¡
```

### Allureå‘½ä»¤

```bash
# ç”ŸæˆæŠ¥å‘Š
allure generate ./reports/allure-results -o ./reports/allure-report --clean

# å¯åŠ¨æœåŠ¡æŸ¥çœ‹æŠ¥å‘Š
allure serve ./reports/allure-results

# æ‰“å¼€å·²ç”Ÿæˆçš„æŠ¥å‘Š
allure open ./reports/allure-report
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ¨¡å—å¯¼å…¥é”™è¯¯

**é”™è¯¯ï¼š** `ModuleNotFoundError: No module named 'utils'`

**è§£å†³ï¼š**
```bash
# ç¡®ä¿åœ¨autotestç›®å½•ä¸‹è¿è¡Œ
cd D:\web-healthcare-platform-master\autotest
pytest
```

### 2. é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°

**é”™è¯¯ï¼š** `FileNotFoundError: é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°`

**è§£å†³ï¼š**
- æ£€æŸ¥ `config/config.yaml` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹è¿è¡Œæµ‹è¯•

### 3. è¿æ¥é”™è¯¯

**é”™è¯¯ï¼š** `ConnectionError` æˆ– `Timeout`

**è§£å†³ï¼š**
- æ£€æŸ¥ `config/config.yaml` ä¸­çš„ `base_url` æ˜¯å¦æ­£ç¡®
- ç¡®ä¿APIæœåŠ¡å·²å¯åŠ¨
- æ£€æŸ¥ç½‘ç»œè¿æ¥

### 4. æ–­è¨€å¤±è´¥

**é”™è¯¯ï¼š** `AssertionError`

**è§£å†³ï¼š**
- æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œäº†è§£å“ªä¸ªæ–­è¨€å¤±è´¥
- æ£€æŸ¥å“åº”æ•°æ®æ˜¯å¦ç¬¦åˆé¢„æœŸ
- ä½¿ç”¨ `pytest -s` æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### 5. Allureå‘½ä»¤æœªæ‰¾åˆ°

**é”™è¯¯ï¼š** `allure: command not found`

**è§£å†³ï¼š**
- Windows: ä¸‹è½½å¹¶å®‰è£… Allure
  - ä¸‹è½½åœ°å€: https://github.com/allure-framework/allure2/releases
  - è§£å‹åæ·»åŠ åˆ°ç³»ç»ŸPATH
- æˆ–è€…ä½¿ç”¨ `pytest-html` ç”ŸæˆHTMLæŠ¥å‘Š

---

## ğŸ“š å­¦ä¹ è·¯å¾„

1. **ç†è§£æ¡†æ¶ç»“æ„** â†’ é˜…è¯» `automation-readme.md`
2. **å­¦ä¹ å·¥å…·ç±»** â†’ é˜…è¯» `utils/` ç›®å½•ä¸‹çš„æ–‡ä»¶
3. **åˆ†ææµ‹è¯•ç”¨ä¾‹** â†’ é˜…è¯» `tests/` ç›®å½•ä¸‹çš„æµ‹è¯•æ–‡ä»¶
4. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹** â†’ å‚è€ƒç°æœ‰ç”¨ä¾‹ç¼–å†™æ–°ç”¨ä¾‹
5. **è¿è¡Œå’Œè°ƒè¯•** â†’ ä½¿ç”¨pytestè¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹æŠ¥å‘Š

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æµ‹è¯•ç”¨ä¾‹å‘½å**ï¼šä½¿ç”¨æ¸…æ™°ã€æè¿°æ€§çš„åç§°
   - âœ… `test_get_doctors_success`
   - âŒ `test_1`

2. **æµ‹è¯•æ­¥éª¤åˆ’åˆ†**ï¼šä½¿ç”¨ `allure.step` æ¸…æ™°åˆ’åˆ†æ­¥éª¤

3. **æ–­è¨€å……åˆ†æ€§**ï¼šä¸ä»…éªŒè¯çŠ¶æ€ç ï¼Œè¿˜è¦éªŒè¯ä¸šåŠ¡é€»è¾‘

4. **æ•°æ®å‡†å¤‡**ï¼šä½¿ç”¨DataGeneratorç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œæé«˜å¯ç»´æŠ¤æ€§

5. **é”™è¯¯å¤„ç†**ï¼šè€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µï¼Œç¼–å†™è´Ÿå‘æµ‹è¯•

6. **ä»£ç å¤ç”¨**ï¼šå°†å…¬å…±é€»è¾‘æå–åˆ°fixtureæˆ–å·¥å…·æ–¹æ³•ä¸­

---

**ç¥ä½ å­¦ä¹ é¡ºåˆ©ï¼** ğŸ‰
